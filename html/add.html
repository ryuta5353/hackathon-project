<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>種を記録する</title>
    <style>
      :root {
        --bg: #EAFAF1;
        --card: #FFFFFF;
        --brand: #56BD7C;
        --brand-600: #56C37E;
        --text: #0F172A;
        --subtext: #56C37E;
        --radius: 20px;
        --shadow: 0 10px 30px rgba(0,0,0,.08);
      }
      *{box-sizing:border-box;}
      body {
        margin:0;
        font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", "Hiragino Kaku Gothic ProN", "Yu Gothic", "Meiryo", "Helvetica Neue", Arial, sans-serif;
        background: var(--bg);
        color: var(--text);
        display:flex;
        justify-content:center;
        align-items:center;
        min-height:100vh;
        padding:40px 16px;
      }
      nav {
        margin-bottom:20px;
        position: absolute;
        top: 20px;
        left: 20px;
      }
      nav a {
        text-decoration:none;
        color:var(--subtext);
        display:inline-flex;
        align-items:center;
        gap:6px;
      }
      nav a:hover {opacity:0.8;}
      main {
        background:var(--card);
        box-shadow:var(--shadow);
        border-radius:var(--radius);
        padding:32px 24px;
        max-width:600px;
        width:100%;
      }
      h1 {
        text-align:center;
        font-size:28px;
        margin-top:0;
        margin-bottom:24px;
      }
      form {
        display:flex;
        flex-direction:column;
        gap:16px;
      }
      textarea {
        resize:vertical;
        min-height:160px;
        padding:16px;
        border-radius:12px;
        border:1px solid #D1D5DB;
        font-size:16px;
        font-family:inherit;
        color:var(--text);
      }
      textarea:focus {
        outline:none;
        border-color: var(--brand);
        box-shadow:0 0 0 2px #A7F3D0;
      }
      button {
        background:var(--brand);
        color:white;
        border:none;
        border-radius:18px;
        font-size:18px;
        font-weight:700;
        padding:18px;
        cursor:pointer;
        transition:filter .2s ease, transform .1s ease;
      }
      button:hover {
        filter:brightness(1.05);
      }
      button:active {
        transform:translateY(1px);
      }
      #result {
        text-align:center;
        margin-top:12px;
        color:var(--subtext);
      }
      .visually-hidden{
        position:absolute !important;
        height:1px;width:1px;
        overflow:hidden;
        clip:rect(1px,1px,1px,1px);
        white-space:nowrap;
      }
    </style>
  </head>
  <body>
    <nav aria-label="ページナビゲーション">
      <a href="#" onclick="history.back(); return false;" aria-label="前の画面に戻る">戻る</a>
    </nav>
    <main role="region" aria-labelledby="page-title">
      <h1 id="page-title">:芽: 種を記録する</h1>
      <form id="seed-form" aria-describedby="form-hint">
        <p id="form-hint"></p>
        <label for="seed-text" class="visually-hidden">アイデアの本文</label>
        <textarea id="seed-text" name="seedText" rows="8" placeholder="ひらめいたアイデアを記録しましょう…" required></textarea>
        <button type="submit" id="submit-btn">記録する</button>
      </form>
      <p id="result" aria-live="polite"></p>
    </main>
    <script type="module">
  import { addSeed } from './storage.js';  // storage.js から addSeed 関数をインポート
  const form   = document.getElementById('seed-form');
  const area   = document.getElementById('seed-text');
  const result = document.getElementById('result');
  form.addEventListener('submit', async (e) => {
    e.preventDefault(); // ページのリロードを防ぐ
    const val = area.value.trim();
    if (!val) {
      // 何も入力されていない場合のエラーメッセージ
      result.textContent = '入力してください。';
      result.style.color = '#B91C1C';
      area.focus();
      return;
    }
    // 成功メッセージを先に表示（保存処理に失敗しても見えるようにする）
    result.textContent = '記録しました。';
    result.style.color = '#15803D';
    // ローカルストレージへ保存（失敗してもエラーだけ出して処理を止めない）
    try {
      addSeed(val);
    } catch (err) {
      console.error('保存に失敗:', err);
      // 必要に応じてエラーメッセージを画面に表示する
      // result.textContent = '保存に失敗しました';
      // result.style.color = '#B91C1C';
    }
    // メインページへ送信（必要な場合のみ）
    try {
      if (window.opener) {
        // 本番環境では '*' をメインページのオリジン（例: 'https://example.com'）に変更する
        window.opener.postMessage({ text: val }, '*');
      }
    } catch (err) {
      console.error('メッセージ送信に失敗:', err);
    }
    // 開発中はウィンドウをすぐ閉じず、メッセージが表示されるか確認する
    // setTimeout(() => window.close(), 1200);
  });
</script>
  </body>
</html>